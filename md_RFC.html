<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>R-Type: RFC: R-Type Multiplayer Game Network Protocol</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">R-Type
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_RFC.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">RFC: R-Type Multiplayer Game Network Protocol</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md34"></a></p>
<h1><a class="anchor" id="autotoc_md35"></a>
Status: Draft</h1>
<p><b>RFC Number:</b> 6969 <b>Title:</b> R-Type Multiplayer Game Network Protocol <b>Author:</b> ETIB Corporation <b>Version:</b> 1.1</p>
<h1><a class="anchor" id="autotoc_md36"></a>
Abstract</h1>
<p>This RFC outlines the network protocol for a multiplayer game inspired by R-Type. The protocol handles real-time communication between a server and multiple clients using TCP for initial connections and UDP for gameplay synchronization. It supports player actions, entity management, and efficient game state updates.</p>
<h1><a class="anchor" id="autotoc_md37"></a>
Table of Contents</h1>
<ol type="1">
<li>Introduction</li>
<li>Requirements</li>
<li><a class="el" href="classMessage.html" title="A class representing a message with an ECS ID and a topic name.">Message</a> Structure<ol type="a">
<li><a class="el" href="structHeader.html">Header</a></li>
<li><a class="el" href="structBody.html">Body</a></li>
</ol>
</li>
<li>Protocol Design<ol type="a">
<li>Connection Establishment</li>
<li>Game State Synchronization</li>
<li>Player Actions</li>
<li>Server-to-Client Messages</li>
<li>Client-to-Server Messages</li>
</ol>
</li>
<li>Error Handling</li>
<li>Security Considerations</li>
<li>Future Work</li>
<li>References</li>
</ol>
<h1><a class="anchor" id="autotoc_md38"></a>
1. Introduction</h1>
<p>This document defines the multiplayer game protocol for a fast-paced side-scrolling shooter similar to R-Type. The protocol uses a hybrid of TCP and UDP to establish client-server communication, ensuring low latency during gameplay while maintaining reliability for critical messages.</p>
<h1><a class="anchor" id="autotoc_md39"></a>
2. Requirements</h1>
<ul>
<li>Support for TCP for reliable initial connections and player identification.</li>
<li>Support for UDP for low-latency, real-time communication during gameplay.</li>
<li>Lightweight message structure to minimize network overhead.</li>
<li>Entity and action synchronization across clients.</li>
<li>Player identification and authentication via unique client IDs.</li>
</ul>
<h1><a class="anchor" id="autotoc_md40"></a>
3. Message Structure</h1>
<h2><a class="anchor" id="autotoc_md41"></a>
3.1. Header</h2>
<p>The header contains essential information about each message, such as the client ID, the action type, and the length of the message body.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structHeader.html">Header</a> {</div>
<div class="line">    uint8_t MagicNumber;</div>
<div class="line">    uint8_t EmitterID;</div>
<div class="line">    uint8_t ReceiverID;</div>
<div class="line">    uint8_t Action;</div>
<div class="line">    uint32_t BodyLength;</div>
<div class="line">};</div>
<div class="ttc" id="astructHeader_html"><div class="ttname"><a href="structHeader.html">Header</a></div><div class="ttdef"><b>Definition</b> PackUnpack.hpp:142</div></div>
</div><!-- fragment --><ul>
<li><b>MagicNumber</b>: <a class="el" href="classA.html">A</a> unique identifier to validate the message format.</li>
<li><b>EmitterID</b>: The ID of the client or server sending the message.</li>
<li><b>ReceiverID</b>: The ID of the client or server receiving the message.</li>
<li><b>Action</b>: The type of action being performed (e.g., input, entity update).</li>
<li><b>BodyLength</b>: The length of the message body in bytes.</li>
</ul>
<h2><a class="anchor" id="autotoc_md42"></a>
3.2. Body</h2>
<p>The body contains data specific to the action being performed, such as player inputs or entity state updates.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define BODY_LENGTH 1024</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="structBody.html">Body</a> {</div>
<div class="line">    uint8_t _buffer[BODY_LENGTH + 1];</div>
<div class="line">};</div>
<div class="ttc" id="astructBody_html"><div class="ttname"><a href="structBody.html">Body</a></div><div class="ttdef"><b>Definition</b> PackUnpack.hpp:152</div></div>
</div><!-- fragment --><p>Example message: </p><div class="fragment"><div class="line">header.MagicNumber = 0x77;</div>
<div class="line">header.EmitterID = 0x01;</div>
<div class="line">header.ReceiverID = 0x02;</div>
<div class="line">header.Action = 0x01;  <span class="comment">// NEW CONNECTION</span></div>
<div class="line">header.BodyLength = 0;</div>
<div class="line">body = NULL;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md43"></a>
Common Action Codes (0x01 -&gt; 0x55)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Action Code   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x01   </td><td class="markdownTableBodyNone">NEW CONNECTION    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x02   </td><td class="markdownTableBodyNone">INPUT   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md44"></a>
Server-to-Client Action Codes (0x56 -&gt; 0xAA)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Action Code   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x56   </td><td class="markdownTableBodyNone">ROLLBACK    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x57   </td><td class="markdownTableBodyNone">UPDATE ECS   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md45"></a>
Client-to-Server Action Codes (0xAA -&gt; 0xFE)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Action Code   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xAB   </td><td class="markdownTableBodyNone">USERNAME    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xAB   </td><td class="markdownTableBodyNone">USERNAME   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md46"></a>
Both Magic Number (0xFF)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Action Code   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xFF   </td><td class="markdownTableBodyNone">MAGIC_NUMBER   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md47"></a>
4. Protocol Design</h1>
<h2><a class="anchor" id="autotoc_md48"></a>
4.1. Connection Establishment</h2>
<p>The client initially connects to the server via TCP to establish the connection and receive its unique ID. After that, gameplay messages are exchanged via UDP for efficiency.</p>
<h3><a class="anchor" id="autotoc_md49"></a>
4.1.1 Server Sends Client ID (TCP)</h3>
<p>Upon successful connection, the server assigns a unique client ID and sends the following message to the client:</p>
<div class="fragment"><div class="line">header.MagicNumber = 0x77;</div>
<div class="line">header.EmmiterID = 0;  <span class="comment">// Server ID</span></div>
<div class="line">header.ReceiverID = CLIENT_ID; <span class="comment">// New client ID</span></div>
<div class="line">header.Action = 0x01;  <span class="comment">// NEW CONNECTION</span></div>
<div class="line">header.BodyLength = 0;</div>
<div class="line">body = NULL;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md50"></a>
4.1.2 Client Acknowledges ID (UDP)</h3>
<p>The client acknowledges the receipt of its ID by sending a message via UDP:</p>
<div class="fragment"><div class="line">header.MagicNumber = 0x77;</div>
<div class="line">header.EmmiterID = CLIENT_ID; <span class="comment">// ID assigned by the server</span></div>
<div class="line">header.ReceiverID = 0;  <span class="comment">// Server ID</span></div>
<div class="line">header.Action = 0x01;  <span class="comment">// NEW CONNECTION</span></div>
<div class="line">header.BodyLength = 0;</div>
<div class="line">body = NULL;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md51"></a>
4.2. Common Action Codes</h2>
<p>The protocol defines several common action codes for handling game state synchronization and player actions:</p>
<ul>
<li><b>NEW CONNECTION (0x02)</b>: Sent by the client to acknowledge the receipt of its ID after connecting to the server.</li>
<li><b>INPUT (0x02)</b>: Sent when the server detects a desynchronization between clients and forces a rollback to a previous game state.</li>
</ul>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor">#define INPUT_LIST_SIZE 5</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>InputData {</div>
<div class="line">    <span class="keywordtype">bool</span> KeyPressed[INPUT_LIST_SIZE]; <span class="comment">// List of keys pressed by the player</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">header.MagicNumber = 0x77;</div>
<div class="line">header.EmmiterID = CLIENT_ID <span class="comment">// Client ID</span></div>
<div class="line">header.ReceiverID = 0x0; <span class="comment">// Server ID</span></div>
<div class="line">header.Action = 0xAA; <span class="comment">// Inpput action</span></div>
<div class="line">header.BodyLength = <span class="keyword">sizeof</span>(InputData);</div>
<div class="line">body = [InputData];  <span class="comment">// Player input data (e.g., direction, attack)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md52"></a>
4.3. Server-to-Client Messages</h2>
<p>The server sends messages to clients to notify them about game state changes. Common server-to-client messages include:</p>
<ul>
<li><b>ROLLBACK (0x56)</b>: Sent when the server detects a desynchronization between clients and forces a rollback to a previous game state.</li>
</ul>
<p>Example: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>RollbackData {</div>
<div class="line">    uint64_t Timestamp; <span class="comment">// Timestamp of the rollback event</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">header.MagicNumber = 0x77;</div>
<div class="line">header.EmmiterID = 0x0; <span class="comment">// Server ID</span></div>
<div class="line">header.ReceiverID = CLIENT_ID; <span class="comment">// Client ID</span></div>
<div class="line">header.Action = 0x56; <span class="comment">// Rollback action</span></div>
<div class="line">header.BodyLength = <span class="keyword">sizeof</span>(RollbackData);</div>
<div class="line">body = [RollbackData];  <span class="comment">// Rollback data (e.g., timestamp, state)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md53"></a>
4.4. Client-to-Server Messages</h2>
<p>Clients send messages to the server to perform actions or provide updates. Common client-to-server messages include:</p>
<ul>
<li><b>USERNAME (0xAB)</b>: Sent during the initial connection to set the playerâ€™s username.</li>
</ul>
<p>Example: </p><div class="fragment"><div class="line"><span class="preprocessor">#define USERNAME_LENGTH 32</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>UsernameData {</div>
<div class="line">    <span class="keywordtype">char</span> Username[USERNAME_LENGTH]; <span class="comment">// Player&#39;s username</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">header.MagicNumber = 0x77;</div>
<div class="line">header.EmitterID = CLIENT_ID; <span class="comment">// Client ID</span></div>
<div class="line">header.ReceiverID = 0x0; <span class="comment">// Server ID</span></div>
<div class="line">header.Action = 0xAB; <span class="comment">// Username action</span></div>
<div class="line">header.BodyLength = <span class="keyword">sizeof</span>(UsernameData);</div>
<div class="line">body = [UsernameData];  <span class="comment">// Username data (e.g., player&#39;s username)</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md54"></a>
5. Error Handling</h1>
<p>The protocol uses a lightweight error-handling mechanism. If a message is lost or malformed, the server or client don't process it and wait for a retransmission.</p>
<ul>
<li><b>Timeouts</b>: Messages that are not acknowledged within a set timeout will be retransmitted.</li>
<li><b>Graceful Reconnection</b>: Clients can attempt to reconnect within a grace period after disconnection.</li>
</ul>
<h1><a class="anchor" id="autotoc_md55"></a>
6. Security Considerations</h1>
<p>The protocol includes basic security measures to ensure fair gameplay and protect against tampering:</p>
<ul>
<li><b><a class="el" href="classSession.html" title="Manages a session using Boost.Asio.">Session</a> Authentication</b>: Players are authenticated using unique session tokens to prevent unauthorized connections.</li>
<li><b>Data Validation</b>: All incoming messages are validated by the server to prevent malicious inputs or buffer overflow attacks.</li>
</ul>
<h1><a class="anchor" id="autotoc_md56"></a>
7. References</h1>
<ul>
<li>RFC 768: User Datagram Protocol</li>
<li>RFC 793: Transmission Control Protocol </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
